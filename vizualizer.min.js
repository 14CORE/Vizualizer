"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Vizualizer=function(){function Vizualizer(){_classCallCheck(this,Vizualizer),this.audioContext=null,this.audioElement=null,this.audioSource=null,this.audioAnalyser=null,this.dataArray=null,this.effects=null,this.requestId=null}return _createClass(Vizualizer,[{key:"start",value:function(){this.requestId=requestAnimationFrame(this.startRender.bind(this))}},{key:"stop",value:function(){cancelRequestAnimFrame(this.requestId)}},{key:"startRender",value:function(){var i=0;for(this.audioAnalyser.getByteFrequencyData(this.dataArray),i;i<this.effects.length;i+=1)this.effects[i].renderEffect(this.dataArray);requestAnimationFrame(this.startRender.bind(this))}},{key:"changeEffect",value:function(effectVizualizer){var i=arguments.length<=1||void 0===arguments[1]?0:arguments[1];void 0!==this.effects[i]&&(this.effects[i].hide(),this.effects[i]=effectVizualizer,this.effects[i].show())}},{key:"addEffect",value:function(effect){this.effects.push(effect),this.effects[this.effects.length-1].show()}},{key:"popEffect",value:function(){this.effects[this.effects.length-1].hide(),this.effects.pop()}},{key:"removeEffect",value:function(index){this.effects[index].hide(),this.effects.splice(index,1)}},{key:"loadAudioContext",value:function(context){this.audioContext=context,this.audioAnalyser=this.audioContext.createAnalyser(),this.dataArray=new Uint8Array(this.dataArray.length),this.audioAnalyser.getByteFrequencyData(this.dataArray)}},{key:"loadElement",value:function(element){this.audioElement=element,this.audioSource=this.audioContext.createMediaElementSource(this.audioElement),this.audioSource.connect(this.audioAnalyser),this.audioSource.connect(this.audioContext.destination)}},{key:"loadArrayBuffer",value:function(arraybuffer){var _this=this;this.audioContext.decodeAudioData(function(buffer){_this.audioSource=_this.audioContext.createBufferSource(),_this.audioSource.connect(_this.audioAnalyser),_this.audioSource.connect(_this.audioContext.destination),_this.audioSource.buffer=buffer})}},{key:"loadDataUrl",value:function(dataUrl){(null===this.audioElement||void 0===this.audioElement)&&(this.audioElement=new Audio,this.audioElement.crossOrigin="anonymous"),this.audioElement.src=dataUrl}}],[{key:"withMedia",value:function(mediaUrl){var vizualizer=(arguments.length<=1||void 0===arguments[1]?1024:arguments[1],new Vizualizer);if(void 0!==typeof AudioContext)vizualizer.audioContext=new AudioContext;else{if(void 0===typeof webkitAudioContext)throw new Error("AudioContext is not supported");vizualizer.audioContext=new webkitAudioContext}vizualizer.audioElement=new Audio,vizualizer.audioElement.crossOrigin="anonymous",vizualizer.audioElement.src=mediaUrl,vizualizer.effects=[]}},{key:"withElement",value:function(element){var bufferLength=arguments.length<=1||void 0===arguments[1]?1024:arguments[1],vizualizer=new Vizualizer;if(void 0!==typeof AudioContext)vizualizer.audioContext=new AudioContext;else{if(void 0===typeof webkitAudioContext)throw new Error("AudioContext is not supported");vizualizer.audioContext=new webkitAudioContext}return vizualizer.audioElement=element,vizualizer.audioElement.crossOrigin="anonymous",vizualizer.audioSource=vizualizer.audioContext.createMediaElementSource(vizualizer.audioElement),vizualizer.audioAnalyser=vizualizer.audioContext.createAnalyser(),vizualizer.audioSource.connect(vizualizer.audioAnalyser),vizualizer.audioSource.connect(vizualizer.audioContext.destination),vizualizer.dataArray=new Uint8Array(bufferLength),vizualizer.effects=[],vizualizer}},{key:"withContextSource",value:function(context,source){var bufferLength=arguments.length<=2||void 0===arguments[2]?1024:arguments[2],vizualizer=new Vizualizer;return vizualizer.audioContext=context,vizualizer.audioSource=source,vizualizer.audioAnalyser=vizualizer.audioContext.createAnalyser(),vizualizer.audioSource.connect(vizualizer.audioAnalyser),vizualizer.audioSource.connect(vizualizer.audioContext.destination),vizualizer.dataArray=new Uint8Array(bufferLength),vizualizer.effects=[],vizualizer}},{key:"withArrayBuffer",value:function(arrayBuffer){var bufferLength=arguments.length<=1||void 0===arguments[1]?1024:arguments[1],vizualizer=new Vizualizer;if(void 0!==typeof AudioContext)vizualizer.audioContext=new AudioContext;else{if(void 0===typeof webkitAudioContext)throw new Error("AudioContext is not supported");vizualizer.audioContext=new webkitAudioContext}return vizualizer.audioAnalyser=vizualizer.audioContext.createAnalyser(),vizualizer.audioContext.decodeAudioData(function(buffer){vizualizer.audioSource=vizualizer.audioContext.createBufferSource(),vizualizer.audioSource.connect(vizualizer.audioAnalyser),vizualizer.audioSource.connect(vizualizer.audioContext.destination),vizualizer.audioSource.buffer=buffer}),vizualizer.dataArray=new Uint8Array(bufferLength),vizualizer.effects=[],vizualizer}}]),Vizualizer}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),EffectVizualizer=function(){function EffectVizualizer(){if(_classCallCheck(this,EffectVizualizer),void 0===this.renderEffect)throw TypeError("renderEffect(dataArray) must be implemented");if(void 0===this.hide)throw TypeError("hide() must be implemented");if(void 0===this.show)throw TypeError("show() must be implemented")}return _createClass(EffectVizualizer,[{key:"renderEffect",value:function(dataArray){}},{key:"hide",value:function(){}},{key:"show",value:function(){}}]),EffectVizualizer}();
